---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# simpleweather

<!-- badges: start -->
[![R-CMD-check](https://github.com/joemarlo/simpleweather/workflows/R-CMD-check/badge.svg)](https://github.com/joemarlo/simpleweather/actions)
[![license](https://img.shields.io/badge/license-MIT + file LICENSE-lightgrey.svg)](https://choosealicense.com/)
[![Last-changedate](https://img.shields.io/badge/last%20change-`r gsub('-', '--', Sys.Date())`-yellowgreen.svg)](/commits/master)
<!-- badges: end -->

simpleweather is an R package that provides a simple interface to get historical and forecasted weather. It does one thing: retrieve basic weather data for a given latitude, longitude location. No anguish to figure out which data source to use, esoteric weather variable to pick, or weather station to choose.

simpleweather is focused and therefore limited to only providing temperature (daily max in Fahrenheit), precipitation (True/False), and wind speed (mph). The package leverages NOAA for historical data and OpenWeather for the latest data.

```{r example}
library(simpleweather)
dates <- Sys.Date() + -7:2
lat <- 40.7812
long <- -73.9665
get_weather(dates, lat, long)
```

## Installation and setup

You can install the development version from [GitHub](https://github.com/joemarlo/simpleweather) with:

``` r
# install.packages("devtools")
devtools::install_github("joemarlo/simpleweather")
```

Requires API keys for the [NOAA API](https://www.ncdc.noaa.gov/cdo-web/webservices/v2) and [OpenWeather API](https://openweathermap.org/api/one-call-api). You can request those keys for free [here](https://www.ncdc.noaa.gov/cdo-web/token) and [here](https://openweathermap.org/price). Historical NOAA weather data only available for the United States.

And then log your API keys via the set_api_key_* functions.

``` r
set_api_key_noaa("<key>")
set_api_key_openweather("<key>")
```

Please credit NOAA and/or OpenWeather as your weather data provider depending on your use.

## Data description

The data comes from different sources and is aggregated to best provide consistent measures. Some caution is necessary if you require precise estimates as definitions slightly differ across the data sources. 

| Type        | Source      | Dataset                         | Temperature                       | Precipitation                                                     | Wind                                     |
|-------------|-------------|---------------------------------|-----------------------------------|-------------------------------------------------------------------|------------------------------------------|
| Historical  | NOAA        | Daily summaries (GHCND)         | `TMAX`: Max daily temperature     | `PRCP` > 0.1 inches                                               | `WSF2`: fastest 2-minute speed in mph    |
| Last 5 days | OpenWeather | One-call time machine "current" | `temp`: TBD                       | `weather-main` one of ('Thunderstorm', 'Drizzle', 'Rain', 'Snow') | `wind_speed`: reported wind speed in mph |
| Forecast    | OpenWeather | One-call "daily"                | `temp$max`: Max daily temperature | `pop` (probability of precipitation) > 0.3                        | `wind_speed`: reported wind speed in mph |

For more detailed weather data, check out the R packages [rnoaa](https://github.com/ropensci/rnoaa) and [owmr](https://github.com/crazycapivara/owmr). These provide nuanced control over requesting data from the NOAA and OpenWeather APIs.


## Todo

- Implement rate limiting messages?
- Figure out timestamp of OpenWeather last 5 days
