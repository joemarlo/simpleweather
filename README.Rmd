---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# simpleweather

<!-- badges: start -->
[![R-CMD-check](https://github.com/joemarlo/simpleweather/workflows/R-CMD-check/badge.svg)](https://github.com/joemarlo/simpleweather/actions)
<!-- badges: end -->

simpleweather is an R package that provides a simple interface to get historical and forecasted weather. It does one thing: retrieve weather data for a given latitude, longitude location. No anguish to figure out which data source to use, esoteric weather variable to pick, or weather station to choose.

simpleweather is focused and therefore limited to only providing the temperature (daily max in Fahrenheit), precipitation (True/False), and the wind speed (fastest 2-minute speed in mph). The package leverages NOAA for historical data and OpenWeather for the latest data.

```{r example}
library(simpleweather)
dates <- Sys.Date() + -7:2
lat <- 40.7812
long <- -73.9665
get_weather(dates, lat, long)
```

## Installation and setup

You can install the development version from [GitHub](https://github.com/joemarlo/simpleweather) with:

``` r
# install.packages("devtools")
devtools::install_github("joemarlo/simpleweather")
```

Requires API keys for the [NOAA API](https://www.ncdc.noaa.gov/cdo-web/webservices/v2) and [OpenWeather API](https://openweathermap.org/api/one-call-api). You can request those keys for free [here](https://www.ncdc.noaa.gov/cdo-web/token) and [here](https://openweathermap.org/price). Historical NOAA weather data only available for the United States.

And then log your API keys via the set_api_key_* functions.

``` r
set_api_key_noaa("<token>")
set_api_key_openweather("<token>")
```

Please credit NOAA and/or OpenWeather as your weather data provider depending on your use.

## Data description

The data comes from different sources and is aggregated to best provide consistent measures. Some caution is necessary if you require precise estimates as definitions slightly differ across the data sources. 

| Type        | Source      | Dataset                         | Temperature | Precipitation             | Wind         |
|-------------|-------------|---------------------------------|-------------|---------------------------|--------------|
| Historical  | NOAA        | Daily summaries (GHCND)         | `TMAX`      | `PRCP` > 0.1 inches       | `WSF2`       |
| Last 5 days | OpenWeather | One-call time machine "current" | `temp`      | `weather-main` == 'Rain'  | `wind_speed` |
| Forecast    | OpenWeather | One-call "daily"                | `temp-max`  | `pop` (probability) > 0.3 | `wind_speed` |

For more detailed weather data, check out the R packages [rnoaa](https://github.com/ropensci/rnoaa) and [owmr](https://github.com/crazycapivara/owmr). These provide nuanced control over requesting data from the NOAA and OpenWeather APIs.


## Todo

- Figure out how to run tests w/o explicit API key
- Implement rate limiting messages?
- Add 'show_requests' argument to get_weather
- Add API key test to set_* functions?
